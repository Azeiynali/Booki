{% extends "base.html" %} {% block head %}
<link rel="stylesheet" href="../static/css/home.css" /> {% endblock %} {% block
Title %}Booki - Home{% endblock %} {% block content %}
<div id="app">
    <navbar
        @comment="open_comd"
        @image="open_immd"
        active_item="home"
        avatar="{{ current_user.avatar }}"
        message_count="{{ not_list }}"
    ></navbar>
    <site-header
        items='
                [
                    {% for user in users %}
                        {"user_img": "{{ user.avatar }}",
                        "user_href": "/@{{ user.username }}",
                        "username": "{{ user.username }}"},
                    {% endfor %}
                ]
            '
    >
    </site-header>
    <div class="container">
        <div class="posts">
            {% for post in posts %}
            <post
                content="<img class='img' src='{{ post.img }}'><p>{{ post.text }}</p>"
                user_detail='{
                                "img": "{{ post.writer.avatar }}",
                                "username": "{{ post.writer.username }}",
                                "ckeck": true,
                                "date": "2 Ù…Ø§Ù‡ Ù¾ÛŒØ´",
                                "href":"/@{{ post.writer.username }}/posts",
                                "post_href": "#"
                                }'
                classes="img-container post"
            ></post>
            {% endfor %}
            <post
                content="<img class='img' src='https://cdn.dribbble.com/userupload/9583660/file/original-e27155a0df451cd4cb30db64a51883a8.jpg?resize=752x'>Ø§ÛŒÙ† ÛŒÚ© ØªØµÙˆÛŒØ± Ø§Ø³Øª Ú©Ù‡ ØªÙˆØ³Ø· ÛŒÚ©ÛŒ Ø¨Ù‡ Ù†Ø§Ù… ÛŒÚ©ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡ Ùˆ Ø¯Ø± Ø­Ø§Ù„ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù† Ø¯Ø± Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ Ø¨Ø²Ø±Ú¯ Ù†ÛŒÙˆÛŒÙˆØ±Ú© Ø§Ø³Øª</p>"
                user_detail='{
                    "img": "https://wordpress.iqonic.design/product/wp/socialv/wp-content/uploads/avatars/18/1656590512-bpfull.jpg",
                    "username": "Ø¹Ù„ÛŒ",
                    "ckeck": true,
                    "date": "2 Ù…Ø§Ù‡ Ù¾ÛŒØ´",
                    "href":"#",
                    "post_href": "#"
                }'
                classes="img-container post"
            ></post>
        </div>
        <div class="left-items">
            <div dir="rtl" class="top">
                <p>Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø±ØªØ±</p>
                <user
                    username="Ø¹Ù„ÛŒ"
                    score="120"
                    href="#"
                    img="https://wordpress.iqonic.design/product/wp/socialv/wp-content/uploads/avatars/18/1656590512-bpfull.jpg"
                ></user>
            </div>
            <div dir="rtl" class="top">
                <p>Ù…Ø­Ù„ Ø´Ù…Ø§</p>
                <user
                    username="Ø¹Ù„ÛŒ"
                    score="120"
                    href="#"
                    img="https://wordpress.iqonic.design/product/wp/socialv/wp-content/uploads/avatars/18/1656590512-bpfull.jpg"
                ></user>
            </div>
        </div>
    </div>
</div>

{% raw %}
<script>
    Vue.component("site-header", {
        props: ["items"],
        data() {
            return {
                items_dict: eval(this.items),
            };
        },
        template: `
            <header ref="root" class="header">
                <a href="/@booki" class="item">
                    <div style="background-image: url(/static/pictures/favicon.png)" class="user"></div>
                    <p>Booki</p>
                </a>
                <a :href="item.user_href" v-for="item in items_dict" class="item">
                    <img :src="item.user_img" class="user" />
                    <p>{{ item.username }}</p>
                </a>
            </header>
                    `,
    });

    Vue.component("post", {
        props: {
            id: {},
            user_detail: {
                default: "{}",
            },
            content: {
                default: "",
            },
            likes: {
                default: 0,
            },
            iw: {
                default: false,
            },
            classes: { default: "post" },
        },
        data() {
            return {
                us_content: unescape(this.content),
                user_details: JSON.parse(this.user_detail),
                is: true,
            };
        },

        methods: {
            like() {
                if (this.$refs.like.getAttribute("class") == "like liked") {
                    this.$refs.like_icon.style.color = "black"
                    this.likes--;
                } else {
                    this.$refs.like_icon.style.color = "var(--red)"
                    this.likes++;
                }
                this.$refs.like.classList.toggle("liked");
            },
            exclamation(ev) {
                this.$refs.message.style.opacity = "1";
                this.$refs.message.style.left = "-19px";
                this.$refs.message.innerText = "Ú¯Ø²Ø§Ø±Ø´ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯!";
                setTimeout(() => {
                    this.$refs.message.style = "";
                    this.$refs.message.style.left = "-19px";
                }, 2000);
            },
            delete_() {
                if (
                    this.$refs.itrash.getAttribute("class") ===
                    "fa-soild fa-check"
                ) {
                    var myHeaders = new Headers();
                    myHeaders.append(
                        "Content-Type",
                        "application/x-www-form-urlencoded"
                    );

                    var urlencoded = new URLSearchParams();
                    urlencoded.append("id", this.id);
                    urlencoded.append(
                        "pin",
                        "FFRRWETER%^%$TYER%#%$R#$%$#^54643643%$#%$#f"
                    );
                    var requestOptions = {
                        method: "DELETE",
                        headers: myHeaders,
                        body: urlencoded,
                        redirect: "follow",
                    };

                    fetch("/api/delPost", requestOptions)
                        .then((response) => response.text())

                        .then((result) => {
                            this.is = false;
                        })
                        .catch((error) => console.log("error", error));
                } else {
                    this.$refs.itrash.setAttribute(
                        "class",
                        "fa-soild fa-check"
                    );
                    this.$refs.trash.setAttribute("class", "like trash liked");
                }
            },
        },
        template: `
                        <div v-if="is" :class="classes">
                            <div dir="rtl" class="user">
                                <a :href="user_details.href">
                                    <img :src="user_details.img" />
                                </a>
                                <a :href="user_details.href">
                                    <div>
                                        <p>
                                            {{ user_details.username }}

                                        </p>
                                        <small>{{ user_details.date }}</small>
                                    </div>
                                </a>
                                <div ref="message" class="details">Ú¯Ø²Ø§Ø±Ø´ Ø¯Ø§Ø¯Ù†</div>
                            </div>
                            <div v-html="us_content" dir="rtl" class="content"></div>
                            <div dir="rtl" class="bottom">
                                <div @click="like" ref="like" class="like">
                                    <i ref="like_icon" class="fi fi-rr-circle-heart"></i>
                                    <small>{{ likes }}</small>
                                </div>
                                <div v-if="iw" @click="delete_" ref="trash" class="like trash">
                                    <i ref="itrash" class="fa-soild fa-trash"></i>
                                </div>
                                </a>
                            </div>
                        </div>
                    `,
    });

    Vue.component("user", {
        props: ["img", "score", "href", "username"],
        template: `
                        <div style="transform: scale(.7);margin-left: 23%;" dir="rtl" class="user">
                                <a :href="href">
                                    <img :src="img" />
                                </a>
                                <a :href="href">
                                    <div>
                                        <p>
                                            {{ username }}

                                        </p>
                                        <small>ðŸª™{{ score }}</small>
                                    </div>
                                </a>
                            </div>
                        `,
    });

    new Vue({
        el: "#app",
        methods: {
            open_comd() {
                this.$refs.comd.open();
            },
            open_immd() {
                this.$refs.immd.open();
            },
        },
    });
</script>
{% endraw %} {% endblock %}
